@model CadQueryInputModel
@inject IViewLocalizer Localizer
@{
    ViewData["Title"] = "All 3D Models";
    ViewBag.Buttons = Array.Empty<string>();
}

<div class="row d-flex justify-content-around">
    <a id="user-cads-wrapper" asp-area="Designer" asp-controller="Cads" asp-action="Index"
            class="col-sm-3 col-12 btn btn-success">
        @Localizer["UrCads"] <br /> <span id="user-cads-count"></span>
    </a>
    <div class="col-4 d-flex justify-content-center align-items-end">
        <h2>@Localizer["Title"]</h2>
    </div>
    <a id="unvalidated-cads-wrapper" asp-area="Designer" asp-controller="Cads" asp-action="Submitted"
            class="col-sm-3 col-12 btn btn-success">
       @Localizer["UnvCads"] <br /> <span id="unvalidated-cads-count"></span>
    </a>
</div>
<hr />

<script>
    $(document).ready(function () {
        $('#user-cads-count').text('@Localizer["Calculating..."]');
        $('#unvalidated-cads-count').text('@Localizer["Calculating..."]');

        function updateProductCount() {
            $.ajax({
                url: '/Home/GetCadsCount',
                method: 'GET',
                success: function (response) {
                    const hasMessage = '@Localizer["Has"]';
                    const hasNotMessage =' @Localizer["Hasn't"]';

                    const userCadsCount = response.userCadsCount;
                    if (userCadsCount > 0) {

                        $('#user-cads-count').text(`${hasMessage} ${userCadsCount}`);
                    }
                    else {
                        $('#user-cads-count').text(hasNotMessage);
                    }
                    
                    const unvCadsCount = response.unvalidatedCadsCount;
                    if (unvCadsCount > 0) {

                        $('#unvalidated-cads-count').text(`${hasMessage} ${unvCadsCount}`);
                    }
                    else {
                        $('#unvalidated-cads-count').text(hasNotMessage);
                    }

                    $('#user-cads-wrapper').removeData.removeClass('d-none');
                    $('#unvalidated-cads-wrapper').removeClass('d-none');
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching product count:', error);
                }
            });
        }
        
        updateProductCount();

        setInterval(updateProductCount, 5000);
    });
</script>

<partial name="_CadQueryPartial" model="Model" view-data="ViewData" />

<div class="container">
    @if (!Model.Cads.Any())
    {
        <p class="text-center">@Localizer["NoCads"]</p>
    }
    else
    {
        <div class="row d-flex">
            @foreach (CadViewModel cad in Model.Cads)
            {
                ViewBag.Header = $"{cad.Name} ({Localizer[cad.Category].Value})";
                <partial name="_CardCadPartial" model="cad" view-data="ViewData" view-data-cols="Model.Cols" />
            }
        </div>
    }
</div>

<partial name="_PaginationPartial" model="Model" view-data="ViewData" />
